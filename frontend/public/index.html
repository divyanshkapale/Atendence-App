<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Attendance System - Government Pench Valley PG College, Parasia</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <img src="logo.png" alt="College Logo" class="college-logo" onerror="this.src='logo.svg'">
                <div class="college-info">
                    <h1 class="college-name">Government Pench Valley PG College, Parasia</h1>
                    <h2 class="department-name">Department of Botany</h2>
                    <h3 class="system-title">ğŸ“¸ E-Attendance System</h3>
                </div>
            </div>
            <div class="user-info">
                <span id="userInfo"></span>
                <button class="btn btn-secondary" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Login Form -->
        <div id="loginSection" class="card">
            <h2 style="text-align: center; margin-bottom: 30px; color: #333;">ğŸ” Login</h2>
            <div id="loginMessage"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" class="input" required>
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" class="input" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Login</button>
            </form>
        </div>

        <!-- Main App (hidden until logged in) -->
        <div id="mainApp" class="hidden">
            <!-- Navigation Tabs -->
            <div class="tabs">
                <!-- Member Navigation -->
                <button class="tab member-only" onclick="showTab('attendance')">ğŸ“¸ Take Attendance</button>
                <button class="tab member-only" onclick="showTab('myRecords')">ğŸ“‹ My Records</button>
                
                <!-- Admin Navigation -->
                <button class="tab admin-only" onclick="showTab('admin')">ğŸ‘¨â€ğŸ’¼ Admin Panel</button>
                <button class="tab admin-only" onclick="showTab('users')">ğŸ‘¥ User Management</button>
            </div>

            <!-- Take Attendance Tab -->
            <div id="attendanceTab" class="card">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">ğŸ“¸ Take Attendance</h2>
                <div id="attendanceMessage"></div>
                
                <!-- Attendance Type Selection -->
                <div id="attendanceTypeSelection" class="hidden">
                    <h3 style="text-align: center; margin-bottom: 20px; color: #555;">Select Attendance Type</h3>
                    <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;">
                        <button type="button" class="btn type-btn" id="checkInBtn" onclick="selectAttendanceType('check-in')">
                            ğŸŸ¢ Check In
                        </button>
                        <button type="button" class="btn type-btn" id="checkOutBtn" onclick="selectAttendanceType('check-out')">
                            ğŸ”´ Check Out
                        </button>
                    </div>
                    <div id="attendanceStatus" class="attendance-status"></div>
                </div>
                
                <div id="uploadSection" class="hidden">
                    <div id="selectedType" class="selected-type"></div>
                    <div class="video-container">
                        <div id="cameraControls">
                            <button type="button" class="btn" onclick="startCamera()">ğŸ“· Start Camera</button>
                            <div style="margin-top: 15px; font-size: 14px; color: #666; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                <p><strong>ğŸ”’ Permissions Required (in order):</strong></p>
                                <p>1. <strong>Location:</strong> Allow location access when prompted (required first)</p>
                                <p>2. <strong>Camera:</strong> Allow camera access when prompted (after location)</p>
                                <p>â€¢ Look for location ğŸ“ and camera ğŸ“· icons in your browser address bar</p>
                                <p>â€¢ For best results, use Chrome, Firefox, or Safari</p>
                            </div>
                        </div>
                        
                        <div id="videoSection" class="hidden">
                            <video id="video" class="video" autoplay playsinline muted webkit-playsinline></video>
                            <div style="margin-top: 15px;">
                                <button type="button" class="btn" onclick="capturePhoto()">ğŸ“¸ Capture Photo</button>
                                <button type="button" class="btn btn-secondary" onclick="stopCamera()">âŒ Stop Camera</button>
                            </div>
                        </div>

                        <div id="photoPreview" class="hidden">
                            <img id="capturedImage" style="max-width: 100%; border-radius: 10px;">
                            <div style="margin-top: 15px;">
                                <button type="button" class="btn" onclick="uploadPhoto()">âœ… Upload Attendance</button>
                                <button type="button" class="btn btn-secondary" onclick="retakePhoto()">ğŸ”„ Retake Photo</button>
                            </div>
                        </div>
                    </div>
                    
                    <canvas id="canvas" class="canvas"></canvas>
                    
                    <div id="locationInfo" class="message info hidden">
                        <p id="locationText"></p>
                    </div>
                    
                    <!-- Manual Location Fallback -->
                    <div id="manualLocationSection" class="hidden" style="margin-top: 20px; padding: 20px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px;">
                        <h4 style="color: #856404; margin-bottom: 15px;">ğŸ“ Manual Location Entry</h4>
                        <p style="color: #856404; margin-bottom: 15px;">If automatic location detection failed, you can enter your location manually:</p>
                        <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                            <input type="number" id="manualLatitude" placeholder="Latitude" step="any" style="flex: 1; min-width: 120px;" class="input">
                            <input type="number" id="manualLongitude" placeholder="Longitude" step="any" style="flex: 1; min-width: 120px;" class="input">
                            <button type="button" class="btn" onclick="useManualLocation()">Use Location</button>
                        </div>
                        <p style="font-size: 12px; color: #856404;">
                            ğŸ’¡ <strong>Tip:</strong> You can get your coordinates from Google Maps by right-clicking on your location and copying the coordinates.
                        </p>
                    </div>
                </div>

                <div id="uploadDisabled" class="hidden">
                    <div class="message info">
                        <p>âœ… You have already uploaded your attendance photo for today!</p>
                        <p>You can upload again tomorrow.</p>
                    </div>
                </div>
            </div>

            <!-- My Records Tab -->
            <div id="myRecordsTab" class="card hidden">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">ğŸ“‹ My Attendance Records</h2>
                <button class="btn" onclick="loadMyRecords()">ğŸ”„ Refresh</button>
                <div id="myRecordsGrid" class="attendance-grid"></div>
            </div>

            <!-- Admin Panel Tab -->
            <div id="adminTab" class="card hidden">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">ğŸ‘¨â€ğŸ’¼ Admin Panel</h2>
                <div id="adminMessage"></div>
                
                <div id="statsSection" class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalRecords">0</div>
                        <div class="stat-label">Total Records</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="todayRecords">0</div>
                        <div class="stat-label">Today's Records</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="uniqueUsers">0</div>
                        <div class="stat-label">Unique Users</div>
                    </div>
                </div>

                <!-- Date Filter Section -->
                <div style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h3 style="margin-bottom: 15px; color: #333;">ğŸ“… Filter Records</h3>
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div>
                            <label for="startDate" style="display: block; margin-bottom: 5px; font-weight: 600;">From Date:</label>
                            <input type="date" id="startDate" class="input" style="width: auto;">
                        </div>
                        <div>
                            <label for="endDate" style="display: block; margin-bottom: 5px; font-weight: 600;">To Date:</label>
                            <input type="date" id="endDate" class="input" style="width: auto;">
                        </div>
                        <div style="align-self: end;">
                            <button class="btn" onclick="filterRecordsByDate()" style="margin-right: 10px;">ğŸ” Filter</button>
                            <button class="btn" onclick="clearDateFilter()" style="background-color: #6c757d;">Clear</button>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 20px; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <button class="btn" onclick="loadAllRecords()">ğŸ”„ Refresh All Records</button>
                    <button class="btn" onclick="exportRecordsToCSV()" style="background: linear-gradient(45deg, #28a745, #20c997);">ğŸ“Š Export to CSV</button>
                    <span id="exportStatus" style="font-size: 14px; color: #666;"></span>
                </div>
                <div id="allRecordsGrid" class="attendance-grid"></div>
            </div>

            <!-- User Management Tab -->
            <div id="usersTab" class="card hidden">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">ğŸ‘¥ User Management</h2>
                
                <div style="margin-bottom: 30px;">
                    <h3>â• Add New User</h3>
                    <div id="userMessage"></div>
                    <form id="addUserForm" style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end;">
                        <input type="text" id="newUsername" class="input" placeholder="Username" required>
                        <input type="password" id="newPassword" class="input" placeholder="Password" required>
                        <select id="newRole" class="input" required>
                            <option value="member">Member</option>
                            <option value="admin">Admin</option>
                        </select>
                        <button type="submit" class="btn">Add User</button>
                    </form>
                </div>

                <button class="btn" onclick="loadUsers()">ğŸ”„ Refresh Users</button>
                <div id="usersGrid"></div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html> 